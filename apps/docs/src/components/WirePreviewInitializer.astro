---
// WirePreviewInitializer.astro
// Auto-initializes wire code preview functionality
// This component is included globally in the Starlight layout

import { initializeWirePreviewEnhancer } from '../lib/wire-preview-enhancer';
---

<!-- Wire preview initializer -->
<script define:vars={{}} is:inline>
  // Client-side initialization of wire preview functionality
  
  function initializeWirePreview() {
    // Find all pre.wire-preview-enabled > code.language-wire blocks
    const codeBlocks = document.querySelectorAll('pre.wire-preview-enabled > code.language-wire');

    codeBlocks.forEach((codeEl) => {
      const preEl = codeEl.parentElement;
      if (!preEl) return;

      // Extract code content
      let codeContent = '';
      const walker = document.createTreeWalker(
        codeEl,
        NodeFilter.SHOW_TEXT,
        null
      );

      let node;
      while ((node = walker.nextNode())) {
        codeContent += node.textContent || '';
      }

      if (!codeContent.trim()) return;

      // Create preview button
      const buttonContainer = document.createElement('div');
      buttonContainer.className = 'wire-preview-controls';

      const button = document.createElement('button');
      button.className = 'wire-preview-btn';
      button.innerHTML = '<span>▶️</span><span>Preview</span>';
      
      button.addEventListener('click', (e) => {
        e.preventDefault();
        console.log('Preview clicked for:', codeContent.substring(0, 50));
        // TODO: Show preview modal
      });

      buttonContainer.appendChild(button);
      preEl.parentElement?.insertBefore(buttonContainer, preEl.nextSibling);
    });
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeWirePreview);
  } else {
    initializeWirePreview();
  }

  // Re-initialize on Astro page transitions
  document.addEventListener('astro:after-swap', initializeWirePreview);
</script>
